// @ts-nocheck
import { NextRequest, NextResponse } from 'next/server';

// Demo content spawning examples - realistic viral content generation
const demoContentOptimizations = {
  'morning productivity routines for entrepreneurs': {
    'social-post': {
      spawnedContent: `ðŸŒ… **THE 5AM CEO SECRET THAT CHANGED EVERYTHING** 

Here's what I learned from 500+ successful entrepreneurs about morning routines...

ðŸ”¥ **THE PRODUCTIVITY STACK:**

â° **5:00 AM** - Wake up (no snooze, no exceptions)
ðŸ“± **5:01 AM** - Airplane mode stays ON for 2 hours
ðŸ’§ **5:05 AM** - 16oz water + electrolytes 
ðŸ§˜ **5:15 AM** - 10 minutes meditation (Headspace or Calm)
ðŸ“ **5:25 AM** - Journal: 3 wins from yesterday + 3 priorities today
â˜• **5:35 AM** - Coffee + 20 minutes deep work on #1 priority
ðŸƒ **6:00 AM** - 20 minutes movement (gym, walk, or yoga)
ðŸ“š **6:30 AM** - 15 minutes learning (audiobook or podcast)

ðŸ’¡ **GAME-CHANGER INSIGHT:**
The first 2 hours of your day determine your next 22 hours.

âœ¨ **RESULTS AFTER 30 DAYS:**
â€¢ 3x more focused decision making
â€¢ 40% increase in deep work completion  
â€¢ 2x energy levels throughout the day
â€¢ Zero morning anxiety or overwhelm

**The secret?** It's not about perfection - it's about CONSISTENCY.

Start with just ONE of these tomorrow. Which one will you choose? ðŸ‘‡

---

**WANT THE COMPLETE MORNING ROUTINE BLUEPRINT?**
Link in bio for my free "5AM CEO Playbook" ðŸ“–

#entrepreneurship #productivity #morningroutine #success #mindset #5amclub #entrepreneur #ceo #hustle #businessowner #startuplife #productivity #entrepreneurmindset #successhabits #businessgrowth #leadership #focus #timemanagement #selfimprovement #motivation

**POST TIMING:** Best posted 6-7 AM or 7-8 PM
**ENGAGEMENT STRATEGY:** Ask question at the end, respond to every comment in first 2 hours
**STORY TIE-IN:** Share behind-the-scenes of your actual morning routine
**CAROUSEL OPPORTUNITY:** Break down into 5-7 slides with visuals for each time slot`,

      improvements: [
        'Added powerful hook with specific credible number (500+ entrepreneurs)',
        'Used time-based structure that creates urgency and specificity', 
        'Included emotional trigger words (SECRET, GAME-CHANGER) for viral potential',
        'Added concrete results with specific percentages for credibility',
        'Integrated call-to-action with lead magnet for list building',
        'Optimized hashtag strategy with trending and niche-specific tags',
        'Provided posting strategy and engagement tactics for maximum reach',
        'Added content expansion opportunities (story tie-in, carousel format)'
      ],
      analysis: {
        viralScore: 92,
        estimatedEngagement: '5.8',
        contentQuality: 'Excellent',
        suggestedHashtags: ['productivity', 'entrepreneur', '5amclub', 'morningroutine', 'success']
      }
    },

    'email-subject': {
      spawnedContent: `**VIRAL EMAIL SUBJECT LINE OPTIONS:**

ðŸ“§ **HIGH-OPEN RATE HOOKS (8-12% expected):**

1. "This 5AM habit is making millionaires... (try it tomorrow)"
2. "[FIRST NAME], why successful CEOs wake up at 4:58 AM ðŸ‘€"
3. "The morning routine that built my $10M company"
4. "I tracked 500 entrepreneurs' mornings. Here's what I found..."
5. "Your 5AM self vs your 9AM self (shocking difference)"

ðŸ“Š **CURIOSITY-DRIVEN (10-15% expected):**

6. "The weird morning ritual 73% of CEOs swear by"
7. "Why I quit coffee at 5 AM (and you should too)"
8. "The 2-minute morning hack that changed everything"
9. "Morning routine or morning roulette? (most people choose roulette)"
10. "What your 5 AM routine says about your bank account"

ðŸ”¥ **URGENCY + SCARCITY (12-18% expected):**

11. "Only sending this morning routine to 1,000 people"
12. "[FIRST NAME], last chance: The 5AM CEO Blueprint"
13. "This morning routine expires at midnight tonight"
14. "47 hours left: Free 5AM productivity system"
15. "Final call: The morning routine that builds empires"

âš¡ **PERSONAL + VULNERABLE (15-22% expected):**

16. "How 5 AM saved my failing business (personal story)"
17. "I was a night owl for 30 years. Then this happened..."
18. "My biggest morning routine mistake cost me $50K"
19. "Why I wake up at 4:47 AM every single day"
20. "The morning routine that ended my 10-year struggle"

ðŸŽ¯ **BENEFIT-FOCUSED (8-14% expected):**

21. "Double your productivity before 7 AM (step-by-step)"
22. "The morning routine that eliminates afternoon crashes"
23. "How to think like a CEO by 6 AM tomorrow"
24. "Turn your morning into a money-making machine"
25. "The 5 AM formula for stress-free success"

**A/B TESTING STRATEGY:**
â€¢ Test personal vs. benefit-focused
â€¢ Test specific numbers vs. general claims  
â€¢ Test urgency vs. curiosity
â€¢ Track opens by day of week and time sent

**BEST SEND TIMES:**
â€¢ Tuesday-Thursday, 6:30-8:30 AM
â€¢ Sunday evening 7-9 PM (for Monday open)

**PERSONALIZATION TIPS:**
â€¢ Use first name in 40% of subject lines
â€¢ Reference subscriber's industry when possible
â€¢ Include location-specific elements for geo-targeted lists`,

      improvements: [
        'Created comprehensive subject line variety for A/B testing optimization',
        'Segmented by psychological triggers (curiosity, urgency, personal, benefit)',
        'Added expected open rates based on subject line psychology',
        'Included advanced personalization and targeting strategies',
        'Provided optimal send timing based on email marketing data',
        'Added testing methodology for continuous improvement',
        'Integrated scarcity and social proof elements for higher conversion',
        'Structured content for easy implementation and campaign planning'
      ],
      analysis: {
        viralScore: 89,
        estimatedEngagement: '12.5',
        contentQuality: 'Excellent',
        suggestedHashtags: ['emailmarketing', 'productivity', 'entrepreneurship', 'marketing', 'copywriting']
      }
    }
  },

  'social media marketing tips for small business': {
    'social-post': {
      spawnedContent: `ðŸ’¥ **SMALL BUSINESS OWNERS: STOP WASTING TIME ON SOCIAL MEDIA**

After managing social media for 200+ small businesses, here are the ONLY 7 tactics that actually move the needle...

ðŸŽ¯ **THE PROFIT-FOCUSED SOCIAL STRATEGY:**

**1. THE 80/20 RULE THAT WORKS**
â€¢ 80% value-driven content (tips, behind-scenes, customer stories)
â€¢ 20% promotional content (products, services, sales)
â€¢ Result: 3x higher engagement, 2x more sales

**2. PLATFORM PRIORITY (Stop being everywhere)**
â€¢ Pick ONE platform and dominate it first
â€¢ Instagram: Visual products/services
â€¢ LinkedIn: B2B/Professional services  
â€¢ Facebook: Local businesses 40+ audience
â€¢ TikTok: Gen Z products/creative services

**3. THE "CUSTOMER SUCCESS FORMULA"**
Share: Problem â†’ Your Solution â†’ Customer Result
Example: "Sarah's bakery was losing money â†’ We optimized her Instagram â†’ Now she sells out daily"

**4. CONTENT BATCHING (Save 15+ hours/week)**
â€¢ Film 20 pieces of content in 2 hours
â€¢ Write 30 captions in 1 sitting
â€¢ Schedule everything for the month
â€¢ Tools: Later, Buffer, or Hootsuite

**5. THE "3-COMMENT RULE"**
Reply to every comment within 3 hours for first 3 hours after posting
Algorithm LOVES engagement velocity

**6. LOCAL SEO HACK**
Use location tags + local hashtags in EVERY post
#YourCitySmallBusiness #YourCityName #LocalBusiness

**7. THE "BEHIND THE SCENES" GOLDMINE**
People buy from people, not businesses
â€¢ Show your process
â€¢ Introduce your team
â€¢ Share your struggles and wins
â€¢ Film "day in the life" content

ðŸ’¡ **REALITY CHECK:**
You don't need 100K followers to make 6-figures. I've seen businesses with 2K engaged followers making $50K/month from social media.

**THE GAME-CHANGER:** Focus on engagement rate, not follower count.

Which tip will you implement first? Drop a ðŸ”¥ if this helped!

---

**WANT MY COMPLETE SMALL BUSINESS SOCIAL MEDIA PLAYBOOK?**
Link in bio for free download ðŸ“ˆ

#smallbusiness #socialmediamarketing #entrepreneur #businessgrowth #marketing #socialmediatips #smallbusinessowner #digitalmarketing #businessstrategy #onlinemarketing #contentmarketing #businesssuccess #marketingtips #socialmedia #entrepreneurship #businessadvice #marketingstrategy #smallbiz #localbusiness #businesscoach`,

      improvements: [
        'Created credibility with specific number (200+ small businesses managed)',
        'Used power words and emotional triggers (STOP WASTING, ONLY tactics)',
        'Structured content with numbered system for easy consumption',
        'Added specific platform recommendations to reduce decision paralysis', 
        'Included time-saving strategies (content batching) for busy owners',
        'Provided actionable formulas and frameworks for immediate implementation',
        'Added reality check with concrete example (2K followers = $50K/month)',
        'Integrated engagement strategy and clear call-to-action'
      ],
      analysis: {
        viralScore: 94,
        estimatedEngagement: '6.2',
        contentQuality: 'Excellent',
        suggestedHashtags: ['smallbusiness', 'socialmediamarketing', 'entrepreneur', 'marketing', 'businessgrowth']
      }
    }
  }
};

// Default fallback content generation
function generateGenericContent(contentType: string, topic: string, audience: string, platform: string) {
  const platformSpecs = {
    instagram: { maxChars: 2200, style: 'visual-focused', hashtags: 30 },
    twitter: { maxChars: 280, style: 'concise-punchy', hashtags: 2 },
    linkedin: { maxChars: 3000, style: 'professional', hashtags: 5 },
    facebook: { maxChars: 63206, style: 'conversational', hashtags: 5 },
    tiktok: { maxChars: 300, style: 'trendy-fun', hashtags: 5 },
    youtube: { maxChars: 5000, style: 'descriptive', hashtags: 15 }
  };

  const spec = platformSpecs[platform] || platformSpecs.instagram;

  let spawnedContent = '';

  switch (contentType) {
    case 'social-post':
      spawnedContent = `ðŸ”¥ **${topic.toUpperCase()}**

Here's what ${audience.toLowerCase()} need to know about ${topic.toLowerCase()}...

ðŸ“Š **KEY INSIGHTS:**

âœ… **Point 1:** Major benefit or insight related to the topic
â€¢ Supporting detail that adds credibility
â€¢ Specific example or statistic

âœ… **Point 2:** Actionable tip or strategy  
â€¢ Step-by-step instruction
â€¢ Expected outcome or result

âœ… **Point 3:** Advanced technique or secret
â€¢ Why most people miss this
â€¢ How to implement effectively

ðŸ’¡ **PRO TIP:** 
The one thing that separates successful people in this area from everyone else.

ðŸš€ **CALL TO ACTION:**
Which tip resonates most with you? Comment below! ðŸ‘‡

---

**Want more ${topic.toLowerCase()} strategies?**
Follow for daily tips and insights ðŸ“ˆ

#${topic.toLowerCase().replace(/\s+/g, '')} #tips #strategy #success #${platform}tips`;
      break;

    case 'email-subject':
      spawnedContent = `**SUBJECT LINE OPTIONS FOR: "${topic}"**

ðŸŽ¯ **CURIOSITY-DRIVEN:**
1. "The ${topic.toLowerCase()} secret nobody talks about"
2. "Why ${audience.toLowerCase()} are getting this wrong"
3. "The surprising truth about ${topic.toLowerCase()}"

ðŸ“Š **BENEFIT-FOCUSED:**  
4. "How to master ${topic.toLowerCase()} in 30 days"
5. "The ultimate ${topic.toLowerCase()} guide for ${audience.toLowerCase()}"
6. "Double your results with this ${topic.toLowerCase()} method"

âš¡ **URGENCY-BASED:**
7. "Last chance: ${topic.toLowerCase()} secrets revealed"
8. "Only 48 hours left for this ${topic.toLowerCase()} training"
9. "Expires tonight: Free ${topic.toLowerCase()} blueprint"

ðŸ‘¤ **PERSONAL:**
10. "My biggest ${topic.toLowerCase()} mistake (and how you can avoid it)"`;
      break;

    case 'blog-intro':
      spawnedContent = `**${topic}** - The Complete Guide for ${audience}

If you're a ${audience.toLowerCase().replace(/and .*/, '')} struggling with ${topic.toLowerCase()}, you're not alone.

Recent studies show that 73% of ${audience.toLowerCase()} face challenges in this area, yet most available advice is either outdated or too generic to be useful.

After working with hundreds of ${audience.toLowerCase()} and analyzing what actually works, I've discovered the exact strategies that separate those who succeed from those who struggle.

In this comprehensive guide, you'll learn:

â€¢ The #1 mistake that's holding you back (and how to fix it immediately)
â€¢ A step-by-step system used by industry leaders
â€¢ Real case studies with measurable results
â€¢ Advanced techniques most people never discover
â€¢ How to avoid the common pitfalls that waste time and money

Whether you're just starting out or looking to optimize your current approach, this guide will give you the clarity and confidence to achieve breakthrough results.

Let's dive in...`;
      break;

    default:
      spawnedContent = `Here's your optimized ${contentType} about ${topic} for ${audience} on ${platform}...

[Content would be generated based on the specific type and platform requirements]`;
  }

  const improvements = [
    `Tailored content format for ${platform} platform specifications`,
    `Optimized for ${audience} demographic and interests`,
    `Added engagement triggers and call-to-action elements`,
    `Structured for maximum readability and shareability`,
    `Included platform-specific hashtag strategy`,
    `Applied viral content principles and psychology`,
    `Optimized length for platform algorithm preferences`
  ];

  return {
    spawnedContent,
    improvements,
    analysis: {
      viralScore: Math.floor(Math.random() * 20) + 75,
      estimatedEngagement: (Math.random() * 3 + 3).toFixed(1),
      contentQuality: 'Good',
      suggestedHashtags: [topic.split(' ')[0].toLowerCase(), 'tips', 'marketing', platform, 'content']
    }
  };
}

export async function POST(request: NextRequest) {
  try {
    const { contentType = 'social-post', topic = '', audience = '', platform = 'instagram' } = await request.json();

    if (!topic || typeof topic !== 'string') {
      return NextResponse.json({ 
        success: false, 
        error: { code: 'INVALID_INPUT', message: 'Topic is required' } 
      }, { status: 400 });
    }

    const trimmedTopic = topic.trim().toLowerCase();

    // Check for predefined demo optimizations
    const topicMatch = demoContentOptimizations[trimmedTopic];
    if (topicMatch && topicMatch[contentType]) {
      return NextResponse.json({ success: true, data: topicMatch[contentType] });
    }

    // Check for partial matches
    for (const [key, value] of Object.entries(demoContentOptimizations)) {
      const keyWords = key.toLowerCase().split(/\s+/);
      const inputWords = trimmedTopic.split(/\s+/);
      const matchCount = keyWords.filter(word => inputWords.some(input => input.includes(word) || word.includes(input))).length;
      
      if (matchCount >= 2 && value[contentType]) {
        return NextResponse.json({ success: true, data: value[contentType] });
      }
    }

    // Generate custom content
    const customContent = generateGenericContent(contentType, topic, audience, platform);
    return NextResponse.json({ success: true, data: customContent });

  } catch (error) {
    console.error('Content demo spawn error:', error);
    return NextResponse.json({ 
      success: false, 
      error: { code: 'DEMO_ERROR', message: 'Failed to process content demo request' } 
    }, { status: 500 });
  }
}